<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Summarize Settings</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main>
      <div class="top">
        <h1>Summarize Settings</h1>
        <div id="buildInfo" class="buildInfo"></div>
      </div>
      <form id="form">
        <section class="section">
          <h2>Token setup</h2>
          <label>
            <span>Token</span>
            <input id="token" type="text" placeholder="(generated in side panel)" />
          </label>
          <div id="daemonStatus" class="daemonStatus">Checking daemon…</div>
          <div id="autoToggle" class="row"></div>
        </section>

        <section class="section">
          <h2>Prompt · Language · Model</h2>
          <label>
            <span>Language</span>
            <div class="combo">
              <select id="languagePreset">
                <option value="auto">Auto (detect)</option>
                <option value="en">English</option>
                <option value="de">German</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="nl">Dutch</option>
                <option value="sv">Swedish</option>
                <option value="no">Norwegian</option>
                <option value="da">Danish</option>
                <option value="fi">Finnish</option>
                <option value="pl">Polish</option>
                <option value="cs">Czech</option>
                <option value="tr">Turkish</option>
                <option value="ru">Russian</option>
                <option value="uk">Ukrainian</option>
                <option value="ar">Arabic</option>
                <option value="hi">Hindi</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh-cn">Chinese (Simplified)</option>
                <option value="zh-tw">Chinese (Traditional)</option>
                <option value="custom">Custom…</option>
              </select>
              <input
                id="languageCustom"
                type="text"
                placeholder="Custom (e.g. en-US / Portuguese (Brazil))"
                autocapitalize="off"
                autocomplete="off"
                spellcheck="false"
                hidden
              />
            </div>
          </label>
          <label>
            <span>Model</span>
            <div class="combo">
              <select id="modelPreset">
                <option value="auto">Auto</option>
                <option value="custom">Custom…</option>
              </select>
              <input
                id="modelCustom"
                type="text"
                placeholder="auto"
                autocapitalize="off"
                autocomplete="off"
                spellcheck="false"
                hidden
              />
            </div>
            <div class="hint">
              Tip: configure “free” models via <code>summarize refresh-free</code> (needs <code>OPENROUTER_API_KEY</code>). Writes
              <code>~/.summarize/config.json</code> (updates <code>models.free</code>). Add <code>--set-default</code> to also set
              your default model to <code>free</code>.
            </div>
          </label>
          <label>
            <span>Prompt override</span>
            <textarea
              id="promptOverride"
              rows="6"
              placeholder="Custom instructions (prefix). Context + content still appended."
            ></textarea>
          </label>
          <label>
            <span>Max chars (extracted)</span>
            <input id="maxChars" type="number" min="20000" step="10000" />
          </label>
        </section>

        <section class="section">
          <h2>UI</h2>
          <div class="uiGrid">
            <div id="pickersRoot"></div>
            <label>
              <span>Font family (CSS)</span>
              <input id="fontFamily" type="text" />
            </label>
            <label>
              <span>Font size</span>
              <input id="fontSize" type="number" min="12" max="20" step="1" />
            </label>
          </div>
        </section>

        <section class="section">
          <h2 class="sectionTitle">
            <button id="advancedToggle" type="button" class="sectionToggle" aria-expanded="false">
              Advanced Overrides
            </button>
          </h2>
          <div class="hint">Values set here override daemon config. Leave blank to use config.</div>
          <div id="advancedFields" class="advancedFields" hidden>
            <label>
              <span>Pipeline mode</span>
              <span class="subtitle">Choose the input pipeline (page text vs URL extraction).</span>
              <select id="requestMode">
                <option value="">Default (auto)</option>
                <option value="page">Page (use visible text)</option>
                <option value="url">URL (force URL extraction)</option>
              </select>
            </label>
            <label>
              <span>Firecrawl</span>
              <span class="subtitle">Firecrawl fetches + cleans pages to Markdown via its API. Off, auto fallback, or always use it.</span>
              <select id="firecrawlMode">
                <option value="">Default (auto)</option>
                <option value="off">Off</option>
                <option value="auto">Auto</option>
                <option value="always">Always</option>
              </select>
            </label>
            <label>
              <span>Markdown mode</span>
              <span class="subtitle">How HTML is converted to Markdown before summarizing.</span>
              <select id="markdownMode">
                <option value="">Default (readability)</option>
                <option value="readability">Readability</option>
                <option value="llm">LLM</option>
                <option value="auto">Auto</option>
                <option value="off">Off</option>
              </select>
            </label>
            <label>
              <span>Preprocess</span>
              <span class="subtitle">For file inputs: convert to text/Markdown first (PDF/Doc/etc) to improve model compatibility.</span>
              <select id="preprocessMode">
                <option value="">Default (off)</option>
                <option value="off">Off</option>
                <option value="auto">Auto</option>
                <option value="always">Always</option>
              </select>
            </label>
            <label>
              <span>YouTube mode</span>
              <span class="subtitle">Auto picks best transcript; Web uses YouTube captions; yt-dlp extracts audio for transcription; Apify is fallback; No-auto skips auto captions.</span>
              <select id="youtubeMode">
                <option value="">Default (config)</option>
                <option value="auto">Auto (best transcript)</option>
                <option value="no-auto">No auto captions</option>
                <option value="yt-dlp">yt-dlp</option>
                <option value="web">Web</option>
                <option value="apify">Apify</option>
              </select>
            </label>
            <label>
              <span>Timeout</span>
              <span class="subtitle">Overall timeout for fetch + model (e.g. 90s, 2m).</span>
              <input id="timeout" type="text" placeholder="2m" />
            </label>
            <label>
              <span>Retries</span>
              <span class="subtitle">LLM retry attempts on timeout (0–5).</span>
              <input id="retries" type="number" min="0" max="5" step="1" />
            </label>
            <label>
              <span>Max output tokens</span>
              <span class="subtitle">Hard cap for model output (e.g. 2k).</span>
              <input id="maxOutputTokens" type="text" placeholder="2k" />
            </label>
          </div>
        </section>

        <div class="buttons">
          <button type="submit">Save</button>
          <span id="status" class="status"></span>
        </div>
      </form>
      <div class="pageFooter hint">
        Made by
        <a href="https://steipete.me" target="_blank" rel="noopener noreferrer">Peter Steinberger</a>
        · MIT licensed ·
        <a href="https://github.com/steipete/summarize/issues" target="_blank" rel="noopener noreferrer"
          >Report issues on GitHub</a
        >
      </div>
    </main>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
