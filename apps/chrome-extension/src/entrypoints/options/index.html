<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Summarize Settings</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main>
      <div class="top">
        <h1>Summarize Settings</h1>
        <div class="topMeta">
          <div id="daemonStatus" class="daemonStatus daemonStatus--compact" data-state="warn">
            <span class="daemonStatus__dot" aria-hidden="true"></span>
            <span class="daemonStatus__text">Checking daemon…</span>
          </div>
          <div id="buildInfo" class="buildInfo"></div>
        </div>
      </div>
      <form id="form">
        <div id="tabs" class="tabs" role="tablist" aria-label="Settings sections">
          <button
            id="tab-general"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="general"
            aria-controls="panel-general"
            aria-selected="true"
          >
            General
          </button>
          <button
            id="tab-ui"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="ui"
            aria-controls="panel-ui"
            aria-selected="false"
          >
            UI
          </button>
          <button
            id="tab-model"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="model"
            aria-controls="panel-model"
            aria-selected="false"
          >
            Model
          </button>
          <button
            id="tab-skills"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="skills"
            aria-controls="panel-skills"
            aria-selected="false"
          >
            Skills
          </button>
          <button
            id="tab-advanced"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="advanced"
            aria-controls="panel-advanced"
            aria-selected="false"
          >
            Advanced
          </button>
          <button
            id="tab-processes"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="processes"
            aria-controls="panel-processes"
            aria-selected="false"
          >
            Processes
          </button>
          <button
            id="tab-logs"
            class="tabButton"
            type="button"
            role="tab"
            data-tab="logs"
            aria-controls="panel-logs"
            aria-selected="false"
          >
            Logs
          </button>
        </div>

        <div id="panel-general" class="tabPanel" role="tabpanel" data-tab-panel="general" aria-labelledby="tab-general">
          <section class="section">
            <div class="combo">
              <div id="autoToggle" class="row"></div>
              <span class="subtitle">Auto-summarize when the panel is open.</span>
            </div>
            <div class="combo">
              <div id="chatToggle"></div>
              <span class="subtitle">Enable Chat mode in the side panel (default on).</span>
            </div>
            <div class="combo">
              <div id="automationToggle"></div>
              <span class="subtitle">Enable website automation tools in the side panel.</span>
            </div>
            <div class="combo">
              <button id="automationPermissions" type="button" class="miniButton">
                Enable automation permissions
              </button>
              <span class="subtitle">Grant optional permissions (userScripts).</span>
            </div>
            <div id="userScriptsNotice" class="notice" hidden></div>
          </section>

          <section class="section">
            <h2>Token setup</h2>
            <label>
              <span>Token</span>
              <div class="inputRow">
                <input id="token" type="text" placeholder="(generated in side panel)" />
                <button id="tokenCopy" type="button" class="miniButton copyButton">Copy</button>
              </div>
            </label>
          </section>
        </div>

        <div id="panel-ui" class="tabPanel" role="tabpanel" data-tab-panel="ui" aria-labelledby="tab-ui" hidden>
          <section class="section">
            <h2>UI</h2>
            <div class="uiGrid">
              <div id="pickersRoot"></div>
              <label>
                <span>Font family (CSS)</span>
                <input id="fontFamily" type="text" />
              </label>
              <label>
                <span>Font size</span>
                <input id="fontSize" type="number" min="12" max="20" step="1" />
              </label>
            </div>
          </section>
        </div>

        <div id="panel-model" class="tabPanel" role="tabpanel" data-tab-panel="model" aria-labelledby="tab-model" hidden>
          <section class="section">
            <h2>Prompt · Language · Model</h2>
            <label>
              <span>Language</span>
              <div class="combo">
                <select id="languagePreset">
                  <option value="auto">Auto (detect)</option>
                  <option value="en">English</option>
                  <option value="de">German</option>
                  <option value="es">Spanish</option>
                  <option value="fr">French</option>
                  <option value="it">Italian</option>
                  <option value="pt">Portuguese</option>
                  <option value="nl">Dutch</option>
                  <option value="sv">Swedish</option>
                  <option value="no">Norwegian</option>
                  <option value="da">Danish</option>
                  <option value="fi">Finnish</option>
                  <option value="pl">Polish</option>
                  <option value="cs">Czech</option>
                  <option value="tr">Turkish</option>
                  <option value="ru">Russian</option>
                  <option value="uk">Ukrainian</option>
                  <option value="ar">Arabic</option>
                  <option value="hi">Hindi</option>
                  <option value="ja">Japanese</option>
                  <option value="ko">Korean</option>
                  <option value="zh-cn">Chinese (Simplified)</option>
                  <option value="zh-tw">Chinese (Traditional)</option>
                  <option value="custom">Custom…</option>
                </select>
                <input
                  id="languageCustom"
                  type="text"
                  placeholder="Custom (e.g. en-US / Portuguese (Brazil))"
                  autocapitalize="off"
                  autocomplete="off"
                  spellcheck="false"
                  hidden
                />
              </div>
            </label>
            <label>
              <span>Model</span>
              <div class="combo">
                <select id="modelPreset">
                  <option value="auto">Auto</option>
                  <option value="custom">Custom…</option>
                </select>
                <input
                  id="modelCustom"
                  type="text"
                  placeholder="auto"
                  autocapitalize="off"
                  autocomplete="off"
                  spellcheck="false"
                  hidden
                />
              </div>
              <div class="hint">
                Tip: configure “free” models via <code>summarize refresh-free</code> (needs <code>OPENROUTER_API_KEY</code>).
                Writes <code>~/.summarize/config.json</code> (updates <code>models.free</code>). Add <code>--set-default</code> to
                also set your default model to <code>free</code>.
              </div>
            </label>
            <label>
              <span>Prompt override</span>
              <textarea
                id="promptOverride"
                rows="6"
                placeholder="Custom instructions (prefix). Context + content still appended."
              ></textarea>
            </label>
            <label>
              <span>Max chars (extracted)</span>
              <input id="maxChars" type="number" min="20000" step="10000" />
            </label>
          </section>
        </div>

        <div
          id="panel-skills"
          class="tabPanel"
          role="tabpanel"
          data-tab-panel="skills"
          aria-labelledby="tab-skills"
          hidden
        >
          <section class="section">
            <h2>Automation Skills</h2>
            <div class="hint">Manage reusable JavaScript libraries for domain-specific automation.</div>
            <div class="skillsActions">
              <button id="skillsExport" type="button" class="miniButton">Export skills</button>
              <button id="skillsImport" type="button" class="miniButton">Import skills</button>
            </div>
            <label>
              <span>Search</span>
              <input id="skillsSearch" type="text" placeholder="Search by name, domain, or description" />
            </label>
            <div id="skillsImportConflicts" class="skillsConflicts" hidden></div>
            <div id="skillsList" class="skillsList"></div>
            <div id="skillsEmpty" class="skillsEmpty" hidden>No skills created yet.</div>
          </section>
        </div>

        <div
          id="panel-advanced"
          class="tabPanel"
          role="tabpanel"
          data-tab-panel="advanced"
          aria-labelledby="tab-advanced"
          hidden
        >
          <section class="section">
            <h2>Advanced Overrides</h2>
            <div class="hint">Values set here override daemon config. Leave blank to use config.</div>
            <div id="advancedFields" class="advancedFields">
              <div class="advancedGrid">
                <div class="combo span-2">
                  <div id="extendedLoggingToggle"></div>
                  <span class="subtitle">
                    Include full input + output in daemon logs (large, only when daemon logging is enabled).
                  </span>
                </div>
                <div class="combo span-2">
                  <div id="hoverSummariesToggle"></div>
                  <span class="subtitle">Show hover summary tooltips in pages. Experimental, default off.</span>
                </div>
                <div class="combo span-2">
                  <div id="summaryTimestampsToggle"></div>
                  <span class="subtitle">
                    Include clickable timestamps in summaries for media (default on).
                  </span>
                </div>
                <div class="combo span-2">
                  <div id="slidesParallelToggle"></div>
                  <span class="subtitle">Show summary first while slides extract in parallel.</span>
                </div>
                <div class="combo span-2">
                  <div id="slidesOcrToggle"></div>
                  <span class="subtitle">Allow OCR text for slides (off by default).</span>
                </div>
                <label class="span-2">
                  <div class="labelRow">
                    <span>Hover summary prompt</span>
                    <button id="hoverPromptReset" type="button" class="miniButton">Reset</button>
                  </div>
                  <span class="subtitle">Prompt used for hover summaries in pages.</span>
                  <textarea id="hoverPrompt" rows="3"></textarea>
                </label>
                <label>
                  <span>Pipeline mode</span>
                  <span class="subtitle">Choose the input pipeline (page text vs URL extraction).</span>
                  <select id="requestMode">
                    <option value="">Default (auto)</option>
                    <option value="page">Page (use visible text)</option>
                    <option value="url">URL (force URL extraction)</option>
                  </select>
                </label>
                <label>
                  <span>Firecrawl</span>
                  <span class="subtitle">
                    Firecrawl fetches + cleans pages to Markdown via its API. Off, auto fallback, or always use it.
                  </span>
                  <select id="firecrawlMode">
                    <option value="">Default (auto)</option>
                    <option value="off">Off</option>
                    <option value="auto">Auto</option>
                    <option value="always">Always</option>
                  </select>
                </label>
                <label>
                  <span>Markdown mode</span>
                  <span class="subtitle">How HTML is converted to Markdown before summarizing.</span>
                  <select id="markdownMode">
                    <option value="">Default (readability)</option>
                    <option value="readability">Readability</option>
                    <option value="llm">LLM</option>
                    <option value="auto">Auto</option>
                    <option value="off">Off</option>
                  </select>
                </label>
                <label>
                  <span>Preprocess</span>
                  <span class="subtitle">
                    For file inputs: convert to text/Markdown first (PDF/Doc/etc) to improve model compatibility.
                  </span>
                  <select id="preprocessMode">
                    <option value="">Default (off)</option>
                    <option value="off">Off</option>
                    <option value="auto">Auto</option>
                    <option value="always">Always</option>
                  </select>
                </label>
                <label>
                  <span>YouTube mode</span>
                  <span class="subtitle">
                    Auto picks best transcript; Web uses YouTube captions; yt-dlp extracts audio for transcription; Apify
                    is fallback; No-auto skips auto captions.
                  </span>
                  <select id="youtubeMode">
                    <option value="">Default (config)</option>
                    <option value="auto">Auto (best transcript)</option>
                    <option value="no-auto">No auto captions</option>
                    <option value="yt-dlp">yt-dlp</option>
                    <option value="web">Web</option>
                    <option value="apify">Apify</option>
                  </select>
                </label>
                <label>
                  <span>Transcriber</span>
                  <span class="subtitle">Override the daemon's default (whisper, parakeet, canary).</span>
                  <select id="transcriber">
                    <option value="">Default (daemon config)</option>
                    <option value="whisper">Whisper (default)</option>
                    <option value="parakeet">NVIDIA Parakeet</option>
                    <option value="canary">NVIDIA Canary</option>
                  </select>
                </label>
                <label>
                  <span>Timeout</span>
                  <span class="subtitle">Overall timeout for fetch + model (e.g. 90s, 2m).</span>
                  <input id="timeout" type="text" placeholder="2m" />
                </label>
                <label>
                  <span>Retries</span>
                  <span class="subtitle">LLM retry attempts on timeout (0–5).</span>
                  <input id="retries" type="number" min="0" max="5" step="1" />
                </label>
                <label>
                  <span>Max output tokens</span>
                  <span class="subtitle">Hard cap for model output (e.g. 2k).</span>
                  <input id="maxOutputTokens" type="text" placeholder="2k" />
                </label>
              </div>
            </div>
          </section>
        </div>

        <div
          id="panel-processes"
          class="tabPanel"
          role="tabpanel"
          data-tab-panel="processes"
          aria-labelledby="tab-processes"
          hidden
        >
          <section class="section">
            <div class="processHeader">
              <div>
                <h2>Process Manager</h2>
                <div class="hint">Track external tools spawned by the daemon (ffmpeg, yt-dlp, tesseract).</div>
              </div>
              <div class="processActions">
                <label class="logsToggle">
                  <input id="processesAuto" type="checkbox" checked />
                  Auto refresh
                </label>
                <button id="processesRefresh" type="button" class="miniButton">Refresh</button>
              </div>
            </div>
            <div class="processControls">
              <label class="processControl">
                <span>Show completed</span>
                <input id="processesShowCompleted" type="checkbox" />
              </label>
              <label class="processControl">
                <span>Limit</span>
                <input id="processesLimit" type="number" min="10" max="200" step="10" value="80" />
              </label>
              <label class="processControl">
                <span>Log tail</span>
                <input id="processesTail" type="number" min="20" max="1000" step="20" value="200" />
              </label>
              <label class="processControl">
                <span>Stream</span>
                <select id="processesStream">
                  <option value="merged">Merged</option>
                  <option value="stdout">Stdout</option>
                  <option value="stderr">Stderr</option>
                </select>
              </label>
            </div>
            <div id="processesMeta" class="hint"></div>
            <div class="processTableWrap">
              <table id="processesTable" class="processTable">
                <thead>
                  <tr>
                    <th>Tool</th>
                    <th>PID</th>
                    <th>Status</th>
                    <th>Elapsed</th>
                    <th>Progress</th>
                    <th>Run</th>
                    <th>Command</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="processLogs">
              <div id="processesLogsTitle" class="processLogsTitle">Logs</div>
              <pre id="processesLogsOutput" class="processLogsOutput"></pre>
            </div>
          </section>
        </div>

        <div
          id="panel-logs"
          class="tabPanel"
          role="tabpanel"
          data-tab-panel="logs"
          aria-labelledby="tab-logs"
          hidden
        >
          <section class="section">
            <div class="logsHeader">
              <h2>Logs</h2>
              <div class="logsActions">
                <button id="logsRefresh" type="button" class="miniButton">Refresh</button>
                <label class="logsAuto">
                  <input id="logsAuto" type="checkbox" />
                  <span>Auto refresh</span>
                </label>
              </div>
            </div>
            <div class="logsControls">
              <label>
                <span>Source</span>
                <select id="logsSource">
                  <option value="extension">extension.log</option>
                  <option value="daemon">daemon.jsonl</option>
                  <option value="stderr">daemon.err.log</option>
                  <option value="stdout">daemon.log</option>
                </select>
              </label>
              <label>
                <span>Tail lines</span>
                <input id="logsTail" type="number" min="100" max="5000" step="100" value="800" />
              </label>
            </div>
            <div class="logsFilters">
              <label class="logsToggle">
                <input id="logsParsed" type="checkbox" checked />
                <span>Parsed</span>
              </label>
              <div class="logsLevelFilters">
                <span class="logsFilterLabel">Levels</span>
                <label>
                  <input type="checkbox" data-log-level="info" checked />
                  <span>Info</span>
                </label>
                <label>
                  <input type="checkbox" data-log-level="warn" checked />
                  <span>Warn</span>
                </label>
                <label>
                  <input type="checkbox" data-log-level="error" checked />
                  <span>Error</span>
                </label>
                <label>
                  <input type="checkbox" data-log-level="verbose" checked />
                  <span>Verbose</span>
                </label>
              </div>
            </div>
            <div id="logsMeta" class="hint"></div>
            <div id="logsOutput" class="logsOutput" aria-live="polite">
              <table id="logsTable" class="logsTable" hidden>
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Level</th>
                    <th>Event</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <pre id="logsRaw" class="logsRaw" hidden></pre>
            </div>
          </section>
        </div>

        <div class="buttons">
          <span id="status" class="status"></span>
        </div>
      </form>
      <div class="pageFooter hint">
        <a href="https://summarize.sh" target="_blank" rel="noopener noreferrer">Summarize</a> made by
        <a href="https://steipete.me" target="_blank" rel="noopener noreferrer">Peter Steinberger</a>
        · MIT licensed ·
        <a href="https://github.com/steipete/summarize/issues" target="_blank" rel="noopener noreferrer"
          >Report issues on GitHub</a
        >
      </div>
    </main>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
